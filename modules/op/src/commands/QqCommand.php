<?php

namespace Op\Commands;

use Illuminate\Console\Command;
use Op\Action\QqAction;
use Op\Models\OpQqToken;
use Poppy\Core\Redis\RdsDb;

/**
 *
 */
class QqCommand extends Command
{

    protected $signature = 'op:qq';

    protected $description = 'qq';

    /**
     * Execute the console command.
     */
    public function handle()
    {
        $QqAction = new QqAction();
        /** @var OpQqToken $token */
        $token = OpQqToken::orderByRaw('rand()')->first();
        if (!$token) {
            // 进行qq登录 得到token 由于没有 直接固定一个
            $url = 'https://imgcache.qq.com/open/connect/widget/mobile/login/proxy.htm?#&t=1634729153#&openid=7DD0B7AD0F1E17ABB36F421152BD9718&appid=1105200115&access_token=EFC665C9839AE5FD595B482BFFA9E5E3&pay_token=824A3193AA73C0E0EFDD650ADACCCD89&key=84e579584b92d537ad32202c30531c6a&serial=&token_key=&browser=0&browser_error=0&status_os=11&sdkv=3.5.3_full&status_machine=HUAWEI2300P&update_auth=1&has_auth=1&auth_time=1634729152460&page_type=1&redirect_uri_key=F902C96298C391AF96A00B0DD29DE69E0C6BF87DA066AA283C10F20D9FB41B54C34DD8BBEAB232E5136EEBFF5600E00ED7A4A6BFF4AF1DCEC630B9323AE82C3E433F9E8BD7D707C73DFE68B4CDB2F82699D4723987B3748A1DBB37B0526C54010B4B5112A62E7D77E40D884BD9BE6734A88C2F58743DC4255D9F71C2E41858AD318C6D5E4535CAC0CD90A015B301CB183F54139467A3EE162C65FA49004C02B89259988EEF2F461C3011CA3CA9B7A460E00A133E3ACB8DCEE20953747C1C4844CB63CBA85422661B7D187974015A821CB1B459A507ED45D2E1D79586745E052EFD0578275951D2A8F352BF37BB9065D8EA287F41A800D87960A799B77A09F52C1E46E30C774360E086F951EA8E12F7EB768487E9DA61A3731AA71489137A128E5D78038C4584F0DB5BFC7F498D8BD8CB';
            if (!$QqAction->saveByUrl($url)) {
                $this->error($QqAction->getError());
                return;
            }
            /** @var OpQqToken $token */
            $token = OpQqToken::orderByRaw('rand()')->first();
            // 进行王者营地登录 得到 token
            $QqAction->oauthInfo($token);
        }
        // // 缓存了1天 */
        // $xToken = $QqAction->getXToken($token);

        // 缓存了1天
        $roles = $QqAction->gameChatRoles($token);
        if (!count($roles)) {
            $this->error('无相关角色, 不进行查询');
            return;
        }

        $rds = RdsDb::instance();
        if (!$rds->exists('op:qq-ids')) {
            $this->ids();
        }

        $id = RdsDb::instance()->lPop('op:qq-ids');

        $role      = collect($roles)->first();
        $campRoles = $QqAction->campRoles($token, $role, $id);
        // $this->info(sys_mark('op', self::class, $campRoles));
        $campRole = collect($campRoles)->first();

        // 获取角色的详情
        $campSkins = $QqAction->playH5GetHeroSkinList2($token, $campRole, $id);
        // $this->info(sys_mark('op', self::class, $campSkins));
    }

    private function ids(): void
    {
        $ids = [
            '3511969',
            '400926839',
            '461090385',
            '215316229',
            '213021754',
            '377606811',
            '220356057',
            '472263850',
            '78584293',
            '414307940',
            '91223609',
            '464528248',
            '359328170',
            '220749087',
            '449076290',
            '96093734',
            '343637988',
            '422156448',
            '348199673',
            '407035401',
            '422983282',
            '76198602',
            '373138147',
            '412667267',
            '338070139',
            '1867922935',
            '92918591',
            '351704204',
            '78527016',
            '331206304',
            '449204597',
            '221370224',
            '326803351',
            '435251497',
            '92576344',
            '79217818',
            '75458429',
            '22055181',
            '237729512',
            '440727329',
            '59154196',
            '371572706',
            '213507089',
            '496869344',
            '233804428',
            '451198129',
            '225897913',
            '422983282',
            '434786529',
            '336874889',
            '53149596',
            '539661434',
            '2186693',
            '344052540',
            '70544702',
            '370187455',
            '324025955',
            '329009838',
            '221447125',
            '224511788',
            '213439215',
            '227017004',
            '76287092',
            '493092673',
            '219880906',
            '3032722',
            '492264531',
            '3419743',
            '436794773',
            '73875179',
            '2144204226',
            '438646592',
            '467525836',
            '325310084',
            '368919400',
            '2122979527',
            '215398041',
            '402841225',
            '335199584',
            '460626381',
            '498909554',
            '428505809',
            '366425794',
            '216313424',
            '2110653968',
            '40162088',
            '425937605',
            '225041073',
            '408685949',
            '230605871',
            '539429738',
            '220512738',
            '427041955',
            '522983895',
            '525149062',
            '5',
            '5',
            '5',
            '165',
            '96128468',
            '77',
            '1879076096',
            '97302505',
            '472701971',
            '490684060',
            '230360405',
            '53645593',
            '460233657',
            '230186189',
            '2115714077',
            '403489172',
            '524872760',
            '470478772',
            '95703177',
            '1894689105',
            '233874924',
            '522032566',
            '76771647',
            '401985054',
            '419228148',
            '544518302',
            '326271325',
            '421810398',
            '1890274418',
            '359518317',
            '453690966',
            '337068725',
            '79316128',
            '340169113',
            '213609039',
            '2146415509',
            '2125285705',
            '482791784',
            '332848212',
            '329677323',
            '342924163',
            '326538660',
            '487067615',
            '361320552',
            '423278455',
            '337699703',
            '96120419',
            '483264350',
            '548268552',
            '223629280',
            '436326836',
            '352798537',
            '355701550',
            '497341041',
            '1830296721',
            '547015113',
            '57067631',
            '344281429',
            '476088202',
            '217931376',
            '352305561',
            '346609279',
            '340837397',
            '413641479',
            '225316823',
            '354723855',
            '539243879',
            '364139257',
            '217118700',
            '70885790',
            '412051844',
            '344094107',
            '355388433',
            '466256054',
            '547926047',
            '474407581',
            '343769383',
            '329315469',
            '367578026',
            '363255610',
            '70726560',
            '221540315',
            '429310016',
            '233297357',
            '235160268',
            '215179522',
            '430098955',
            '232539835',
            '474828703',
            '422761581',
            '459663849',
            '348581347',
            '3015701',
            '79070395',
            '23',
            '7762425',
            '354238065',
            '330635710',
            '436772044',
            '72585620',
            '323597507',
            '446226332',
            '442845058',
            '496986629',
            '492394309',
            '405601523',
            '75713646',
            '58687850',
            '470135587',
            '373098344',
            '228167392',
            '470585487',
            '482152399',
            '494812679',
            '214841791',
            '362674135',
            '323597507',
            '73638365',
            '349343771',
            '406853110',
            '370068771',
            '211933900',
            '232078115',
            '338758659',
            '430895032',
            '1868998191',
            '451608112',
            '50141300',
            '235958180',
            '351382045',
            '348942649',
            '58328850',
            '91972157',
            '339640331',
            '211969832',
            '374459837',
            '530745322',
            '1898527004',
            '221763662',
            '375723569',
            '499744252',
            '421860363',
            '217261299',
            '418220830',
            '225158558',
            '220353998',
            '443533983',
            '91822947',
            '236929513',
            '73273144',
            '367118288',
            '338160346',
            '353067291',
            '94417500',
            '538967369',
            '371949067',
            '78651347',
            '442970625',
            '53375597',
            '79907838',
            '448675134',
            '341918703',
            '463955844',
            '2119272840',
            '354291538',
            '95547131',
            '226470096',
            '79382449',
            '445004512',
            '218721915',
            '349784389',
            '369822052',
            '424653420',
            '404382365',
            '1841343116',
            '420992164',
            '462125793',
            '79251784',
            '2116402531',
            '1874965720',
            '4',
            '3278533',
            '467948629',
            '70282711',
            '330828983',
            '5',
            '336286305',
            '2536990',
            '98186744',
            '497117562',
            '93804175',
            '481853801',
            '540607827',
            '77128028',
            '230856239',
            '7959855',
            '364718089',
            '2138260862',
            '369443599',
            '215018927',
            '367398410',
            '73729405',
            '472127028',
            '1867974577',
            '92415767',
            '78473625',
            '427081034',
            '529670622',
            '418364581',
            '406361408',
            '533965627',
            '418454616',
            '76293689',
            '544354847',
            '3150986',
            '2137133418',
            '150',
            '411803932',
            '489846281',
            '1880119099',
            '426795694',
            '468809016',
            '422818346',
            '215536935',
            '336496679',
            '494016319',
            '235590346',
            '485251934',
            '472735561',
            '539625425',
            '534707972',
            '211861685',
            '413859351',
            '473347246',
            '361006341',
            '441753469',
            '356103182',
            '498435706',
            '411046825',
            '489087413',
            '92507581',
            '320049106',
            '365769071',
            '218062269',
            '449337986',
            '349327421',
            '329274901',
            '5',
            '2112419332',
            '1',
            '1880996490',
            '52548997',
            '472764592',
            '343904118',
            '11',
            '2141600970',
            '5',
            '1855263764',
            '215144308',
            '1834492698',
            '75786919',
            '525149062',
            '549580157',
            '322985227',
            '5',
            '542287155',
            '52926651',
            '5',
            '1890528136',
            '1874965720',
            '1834492698',
            '530826166',
            '5',
            '480659341',
            '5',
            '3812853',
            '339635769',
            '54508464',
            '474418142',
            '462611635',
            '405924090',
            '2130217013',
            '79126827',
            '534479659',
            '338120569',
            '236817180',
            '70653436',
            '332589965',
            '462404478',
            '488974202',
            '77016353',
            '221630731',
            '464392634',
            '491065173',
            '360681643',
            '433542201',
            '410869728',
            '452694537',
            '92845327',
            '338693029',
            '1883637968',
            '1852393168',
            '338908796',
            '458916257',
            '470032504',
            '231389418',
            '59475383',
            '483082782',
            '21437428',
            '214534376',
            '496724870',
            '94768316',
            '522549105',
            '98224668',
            '98224668',
            '2134368830',
            '100',
            '223864067',
            '98387177',
            '2115601687',
            '529984350',
            '2143766816',
            '75786919',
            '73834318',
            '2120379686',
            '514810214',
            '221618440',
            '1836407422',
            '70136220',
            '487584047',
            '331004302',
            '2117919216',
            '230276972',
            '2129230581',
            '221929779',
            '1854604418',
            '469935377',
            '436455946',
            '1877364398',
            '52975928',
            '405963885',
            '221618440',
            '76352207',
            '94152650',
            '525149062',
            '349350784',
            '1831473048',
            '438091061',
            '182',
            '330988927',
            '358338749',
            '460495453',
            '330941142',
            '1886586100',
            '453959862',
            '30641473',
            '2137784593',
            '324041627',
            '3535063190',
            '404150264',
            '349317013',
            '347493097',
            '347493097',
            '498296411',
            '350226776',
            '526940181',
            '205',
            '374883209',
            '198',
            '449686284',
            '189',
            '205',
            '540538615',
            '205',
            '205',
            '205',
            '204',
            '495057811',
            '205',
            '326382899',
            '204',
            '205',
            '200',
            '204',
            '205',
            '205',
            '205',
            '216732973',
            '205',
            '205',
            '205',
            '205',
            '205',
            '200',
            '2126795486',
            '468066383',
            '205',
            '200',
            '205',
            '200',
            '205',
            '204',
            '212',
            '200',
            '184',
            '347245769',
            '200',
            '1860908933',
            '200',
            '94152650',
            '200',
            '2116909265',
            '200',
            '200',
            '183',
            '200',
            '211',
            '200',
            '430914268',
            '76352207',
            '200',
            '423224558',
            '200',
            '446004873',
            '210',
            '347854813',
            '201',
            '70097423',
            '368046383',
            '356658820',
            '2',
            '200',
            '200',
            '200',
            '437101351',
            '200',
            '489606155',
            '200',
            '211',
            '453707719',
            '468066383',
            '200',
            '200',
            '200',
            '199',
            '246530512',
            '200',
            '200',
            '46',
            '200',
            '5',
            '200',
            '200',
            '200',
            '200',
            '200',
            '210',
            '200',
            '1866895139',
            '200',
            '200',
            '98504309',
            '83',
            '200',
            '211',
            '200',
            '200',
            '2477018',
            '101',
            '200',
            '427039440',
            '200',
            '200',
            '529259720',
            '77820436',
            '72151094',
            '361944714',
            '200',
            '200',
            '200',
            '373472304',
            '200',
            '200',
            '200',
            '3209744610',
            '3209744610',
            '373472304',
            '200',
            '200',
            '200',
            '200',
            '200',
            '210',
            '200',
            '200',
            '489606155',
            '1872240459',
            '200',
            '237298223',
            '200',
            '67',
            '200',
            '200',
            '79927189',
            '183',
            '2001630',
            '200',
            '200',
            '200',
            '200',
            '200',
            '463717633',
            '251',
            '200',
            '200',
            '343947424',
            '200',
            '200',
            '413200756',
            '183',
            '181',
            '200',
            '378244311',
            '526192632',
            '200',
            '200',
            '9',
            '200',
            '402183716',
            '200',
            '367984915',
            '210',
            '446857985',
            '200',
            '211',
            '200',
            '226114697',
            '1',
            '217',
            '200',
            '189',
            '185',
            '368046383',
            '475961057',
            '212088957',
            '200',
            '214',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '93929074',
            '200',
            '338503752',
            '1',
            '150',
            '402183716',
            '200',
            '200',
            '87',
            '200',
            '200',
            '415906845',
            '439592250',
            '348545896',
            '200',
            '464898326',
            '200',
            '200',
            '200',
            '463933727',
            '200',
            '76241548',
            '227386635',
            '227386635',
            '92779885',
            '200',
            '12',
            '200',
            '3361158',
            '200',
            '180',
            '180',
            '495395690',
            '212088957',
            '200',
            '422176848',
            '211',
            '200',
            '200',
            '326382899',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '69',
            '76182149',
            '1',
            '93929074',
            '200',
            '530542169',
            '3529394153',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '541008755',
            '354291538',
            '371143129',
            '217',
            '71394191',
            '1832338557',
            '203',
            '200',
            '94079812',
            '30',
            '329524031',
            '200',
            '2126075914',
            '200',
            '200',
            '200',
            '2139332653',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '50518332',
            '2139894874',
            '468294094',
            '361469957',
            '495395690',
            '200',
            '200',
            '200',
            '50518332',
            '200',
            '2126075914',
            '200',
            '200',
            '200',
            '94357817',
            '209',
            '547398683',
            '200',
            '449647599',
            '200',
            '2139410461',
            '483260618',
            '403886900',
            '200',
            '235940287',
            '72951898',
            '448715077',
            '75146931',
            '431860100',
            '460048655',
            '2136100174',
            '200',
            '374685730',
            '404184576',
            '360860948',
            '65',
            '2135290826',
            '200',
            '361469957',
            '200',
            '75061509',
            '99381910',
            '214338100',
            '330830462',
            '214593623',
            '437144026',
            '346934360',
            '453950986',
            '76261037',
            '76261037',
            '237972658',
            '483702281',
            '401625285',
            '79104512',
            '347105692',
            '78192286',
            '211901698',
            '91741027',
            '2139788245',
            '24593623',
            '415626050',
            '9271809',
            '527223157',
            '408480145',
            '427039440',
            '416246880',
            '200',
            '200',
            '361498587',
            '460780862',
            '200',
            '200',
            '200',
            '200',
            '235516139',
            '361050249',
            '200',
            '2112419332',
            '200',
            '200',
            '200',
            '361050249',
            '452921656',
            '200',
            '200',
            '30512518',
            '407017634',
            '200',
            '360860948',
            '340342478',
            '200',
            '30512518',
            '74953467',
            '1',
            '492474851',
            '362403416',
            '200',
            '79673909',
            '218834371',
            '457885153',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '200',
            '79673909',
            '200',
            '200',
            '200',
            '185',
            '9',
            '91316991',
            '200',
            '200',
            '200',
            '206',
            '407060295',
            '200',
            '200',
            '334896571',
            '2119028649',
            '200',
            '352730176',
            '375830435',
            '200',
            '201',
            '200',
            '72991552',
            '217',
            '10',
            '198',
            '478492127',
            '94357817',
            '200',
            '2129275540',
            '338296320',
            '200',
            '199',
            '200',
            '200',
            '205',
            '200',
            '2139332653',
            '200',
            '200',
            '415760237',
            '200',
            '200',
            '541960272',
            '200',
            '4457376',
            '200',
            '210',
            '200',
            '200',
            '183',
            '209',
            '3414302690',
            '72507636',
            '1',
            '92246723',
            '200',
            '200',
            '206',
            '200',
            '200',
            '402696858',
            '12',
            '540897339',
            '540897339',
            '200',
            '200',
            '200',
            '200',
            '200',
            '1886185844',
            '200',
            '200',
            '442694882',
            '341706946',
            '354138326',
            '155',
            '435129336',
            '417781355',
            '452336589',
            '75235913',
            '7092979',
            '91',
            '200',
            '221878597',
            '531248458',
            '471435780',
            '231243942',
            '455323907',
            '72550657',
            '230039046',
            '13',
            '200',
            '200',
            '420781475',
            '336116284',
            '332705150',
            '218093329',
            '200',
            '200',
            '200',
            '200',
            '209',
            '185',
            '370949826',
            '200',
            '436',
            '129',
            '462935641',
            '200',
            '1111141',
            '213509422',
            '200',
            '200',
            '547220689',
            '325105471',
            '200',
            '415906845',
            '343831832',
            '185',
            '200',
            '484597167',
        ];

        RdsDb::instance()->lPush('op:qq-ids', $ids);
    }
}